# 邮件系统集成说明

## 概述

邮件系统已成功集成到VCampus主服务器中，与其他模块（用户管理、学籍管理、课程管理、商店、图书馆）共享同一个服务器架构。

## 集成方式

### 1. 架构集成
- **服务器**: 使用现有的 `MainServer` 和 `SocketServer`
- **消息路由**: 通过 `MessageController` 统一处理所有请求
- **线程池**: 共享现有的连接池和工作池
- **端口**: 使用统一的9090端口

### 2. 代码集成
- **EmailController**: 已集成到 `MessageController` 中
- **ActionType**: 邮件相关的操作类型已添加到枚举中
- **Message**: 使用统一的 `Message` 对象进行通信

## 启动方式

### 启动主服务器（包含邮件功能）
```bash
# 方法一：使用Maven
mvn clean compile
mvn exec:java -Dexec.mainClass="com.vcampus.server.MainServer"

# 方法二：直接运行
java -cp "target/classes;target/lib/*" com.vcampus.server.MainServer
```

### 验证邮件功能
```bash
# 运行集成测试
java -cp "target/classes;target/lib/*" com.vcampus.server.test.EmailIntegrationTest
```

## 邮件功能列表

### 用户功能
- `EMAIL_SEND`: 发送邮件
- `EMAIL_SAVE_DRAFT`: 保存草稿
- `EMAIL_GET_INBOX`: 获取收件箱
- `EMAIL_GET_SENT`: 获取发件箱
- `EMAIL_GET_DRAFT`: 获取草稿箱
- `EMAIL_READ`: 阅读邮件
- `EMAIL_DELETE`: 删除邮件
- `EMAIL_MARK_READ`: 标记已读
- `EMAIL_MARK_UNREAD`: 标记未读
- `EMAIL_SEARCH`: 搜索邮件
- `EMAIL_GET_UNREAD_COUNT`: 获取未读数量
- `EMAIL_BATCH_MARK_READ`: 批量标记已读
- `EMAIL_BATCH_DELETE`: 批量删除

### 管理员功能
- `EMAIL_ADMIN_GET_ALL`: 获取所有邮件
- `EMAIL_ADMIN_GET_USER_EMAILS`: 获取用户邮件
- `EMAIL_ADMIN_DELETE`: 管理员删除邮件
- `EMAIL_ADMIN_GET_STATISTICS`: 获取统计信息

## 使用示例

### 客户端发送邮件请求
```java
Map<String, String> data = new HashMap<>();
data.put("senderId", "user001");
data.put("recipientId", "user002");
data.put("subject", "邮件主题");
data.put("content", "邮件内容");

Message request = new Message(ActionType.EMAIL_SEND, data, true, "发送邮件");
// 通过Socket发送到服务器...
```

### 服务器响应
```java
// 服务器会自动路由到EmailController处理
// 返回统一的Message响应格式
Message response = messageController.handleMessage(request);
```

## 优势

1. **统一架构**: 所有模块共享同一个服务器和线程池
2. **统一通信**: 使用相同的Message协议
3. **统一管理**: 通过MessageController统一路由
4. **资源共享**: 共享数据库连接和配置
5. **易于维护**: 代码结构清晰，便于扩展

## 注意事项

1. **端口统一**: 所有功能都使用9090端口
2. **线程共享**: 邮件处理与其他模块共享线程池
3. **数据库共享**: 使用相同的数据库连接
4. **错误处理**: 统一的错误处理机制

---

邮件系统现已完全集成到VCampus主服务器中，可以与其他模块协同工作！
