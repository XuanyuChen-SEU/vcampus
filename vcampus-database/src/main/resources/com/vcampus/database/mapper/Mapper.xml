<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    namespace：名称空间
-->
<mapper namespace="com.vcampus.database.mapper.Mapper">


    <update id="createDatabase">
            CREATE DATABASE IF NOT EXISTS vcampus_db
        CHARACTER SET utf8mb4
        COLLATE utf8mb4_unicode_ci
    </update>



    <update id="dropDatabase">
        DROP DATABASE IF EXISTS vcampus_db
    </update>






    <update id="dropTables">
        DROP TABLE IF EXISTS vcampus_db.tb_user
        DROP TABLE IF EXISTS vcampus_db.tb_student
    </update>

    <update id="InsertTempData">
        <!-- 批量插入固定用户数据（userId和password均为7位数字字符串） -->
        INSERT INTO vcampus_db.tb_user (userId, password)
        VALUES
        ('1234567', '7654321'),  <!-- 字符串类型需用单引号包裹 -->
        ('2345678', '8765432'),
        ('3456789', '9876543'),
        ('4567890', '0987654'),
        ('5678901', '1098765')

        INSERT INTO vcampus_db.tb_student (userId, studentId, cardId, name, gender, college, major, grade, birth_date, native_place, politics_status, student_status)
        VALUES
            ('1234567', '20210001', '123456789', '张三', '男', '计算机学院', '计算机科学与技术', 2021, '2003-09-01', '北京市', '共青团员', '在读'),
            ('2345678', '20210002', '987654321', '李四', '女', '电子工程学院', '电子信息工程', 2021, '2003-10-15', '上海市', '共青团员', '在读'),
            ('3456789', '20220001', '112233445', '王五', '男', '数学学院', '数学与应用数学', 2022, '2004-05-20', '广州市', '群众', '在读'),
            ('4567890', '20230001', '556677889', '赵六', '女', '文学院', '汉语言文学', 2023, '2005-02-10', '成都市', '共青团员', '在读')
    </update>
    <update id="createUserTable">
        <!-- 显式指定在 Vcampus_db 数据库下创建 user 表 -->
        CREATE TABLE IF NOT EXISTS vcampus_db.`tb_user` (
        `userId` VARCHAR(50) NOT NULL COMMENT '用户ID（7位数字字符串）',
        `password` VARCHAR(50) NOT NULL COMMENT '密码（7位数字字符串）',
        PRIMARY KEY (`userId`) -- 建议加主键，避免重复插入
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

    </update>
    <update id="createStudentTable">
        CREATE TABLE IF NOT EXISTS vcampus_db.`tb_student`(
                                                              `userId` VARCHAR(64) NOT NULL PRIMARY KEY COMMENT '用户ID（主键）',
            `studentId` CHAR(8) COMMENT '学号（8位数字）',
            `cardId` CHAR(9) COMMENT '一卡通号（9位数字）',
            `name` VARCHAR(50) NOT NULL COMMENT '姓名',
            `gender` VARCHAR(10) COMMENT '性别',
            `college` VARCHAR(100) COMMENT '学院',
            `major` VARCHAR(100) COMMENT '专业',
            `grade` INT COMMENT '年级（如 2023）',
            `birth_date` DATE COMMENT '出生日期',
            `native_place` VARCHAR(100) COMMENT '籍贯',
            `politics_status` VARCHAR(50) COMMENT '政治面貌',
            `student_status` VARCHAR(50) COMMENT '学籍状态'
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学生信息表（以userId为主键）';

    </update>
    <update id="createPasswordResetApplicationTable">
        CREATE TABLE IF NOT EXISTS vcampus_db.tb_password_reset_application (
            userId VARCHAR(50) NOT NULL COMMENT '申请密码重置的用户ID（7位数字字符串）',
            newPassword VARCHAR(50) NOT NULL COMMENT '新密码',
            submitTime DATETIME NOT NULL COMMENT '用户提交申请的时间',
            PRIMARY KEY (userId),
            INDEX idx_userId (userId),
            INDEX idx_submitTime (submitTime)
        ) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic COMMENT = '密码重置申请表';
    </update>


    <update id="loadStudentsFromCsv">
        LOAD DATA LOCAL INFILE #{filePath}
        INTO TABLE tb_student
        CHARACTER SET utf8mb4
        FIELDS TERMINATED BY ','
        LINES TERMINATED BY '\n'
        IGNORE 1 ROWS
        (userId, studentId, cardId, name, gender, college, major, grade, @birth_date_var, native_place, politics_status, student_status)
        SET birth_date = STR_TO_DATE(@birth_date_var, '%d/%m/%Y');
    </update>
    <update id="loadUsersFromCsv">
        LOAD DATA LOCAL INFILE #{filePath}
        INTO TABLE tb_user
        FIELDS TERMINATED BY ','
        LINES TERMINATED BY '\n'
        IGNORE 1 ROWS
        (userId, password)
    </update>


</mapper>