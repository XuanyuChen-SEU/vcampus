<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vcampus.database.mapper.ClassSessionMapper">
    <update id="loadClassSessionsFromCsv">
        LOAD DATA LOCAL INFILE #{filePath}
        INTO TABLE vcampus_db.tb_class_sessions
        CHARACTER SET utf8mb4
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"' -- 添加此行以支持带引号的字段
        LINES TERMINATED BY '\n'
        IGNORE 1 ROWS
        (sessionId, courseId, teacherName, scheduleInfo, capacity, enrolledCount);
    </update>

    <select id="selectById" resultType="com.vcampus.common.dto.ClassSession">
        SELECT sessionId, courseId, teacherName, scheduleInfo, capacity, enrolledCount
        FROM vcampus_db.tb_class_sessions WHERE sessionId = #{sessionId}
    </select>

    <select id="selectSessionsByStudentId" resultType="com.vcampus.common.dto.ClassSession">
        SELECT s.*
        FROM vcampus_db.tb_class_sessions s
                 JOIN vcampus_db.tb_course_selections cs ON s.sessionId = cs.sessionId
        WHERE cs.studentId = #{studentId}
    </select>

    <update id="incrementEnrolledCount">
        UPDATE vcampus_db.tb_class_sessions SET enrolledCount = enrolledCount + 1 WHERE sessionId = #{sessionId}
    </update>

    <update id="decrementEnrolledCount">
        UPDATE vcampus_db.tb_class_sessions SET enrolledCount = enrolledCount - 1 WHERE sessionId = #{sessionId}
    </update>
</mapper>