# VCampus 项目开发注意事项

## 网络通信相关注意事项

### 1. 添加新功能时的必要步骤

#### 1.1 在 ActionType 枚举中添加新的动作类型

**位置**: `vcampus-common/src/main/java/com/vcampus/common/enums/ActionType.java`

```java
public enum ActionType {
    LOGIN,
    GLOBAL_NOTIFICATION,
    SYSTEM_BROADCAST,
    EMERGENCY_NOTIFICATION,
    // 添加新功能时，在这里添加新的枚举值
    // 例如：REGISTER, QUERY_COURSE, BORROW_BOOK 等
}
```

#### 1.2 在服务端 MessageController 中添加处理逻辑

**位置**: `vcampus-server/src/main/java/com/vcampus/server/controller/MessageController.java`

**步骤1**: 添加控制器实例字段

```java
public class MessageController {
    private LoginController loginController;
    // 添加新功能时，在这里添加新的控制器实例
    // private RegisterController registerController;
  
    public MessageController() {
        this.loginController = new LoginController();
        // 添加新功能时，在这里实例化新的控制器
        // this.registerController = new RegisterController();
    }
}
```

**步骤2**: 在 handleMessage 方法中添加 case 分支

```java
public void handleMessage(Message message) {
    switch (message.getAction()) {
        case LOGIN:
            // 现有登录处理逻辑
            break;
        // 添加新功能时，在这里添加新的 case 分支
        // case REGISTER:
        //     return registerController.handleRegister(message);
        //     break;
        default:
            System.out.println("未处理的消息类型: " + message.getAction());
            break;
    }
}
```

#### 1.3 在客户端 MessageController 中添加处理逻辑

**位置**: `vcampus-client/src/main/java/com/vcampus/client/controller/MessageController.java`

**步骤1**: 添加控制器实例字段和设置方法

```java
public class MessageController {
    private LoginController loginController;
    // 添加新功能时，在这里添加新的控制器实例
    // private RegisterController registerController;
  
    // 现有的设置方法
    public void setLoginController(LoginController controller) {
        this.loginController = controller;
    }
  
    // 添加新功能时，在这里添加新的设置方法
    // public void setRegisterController(RegisterController controller) {
    //     this.registerController = controller;
    // }
}
```

**步骤2**: 在 handleMessage 方法中添加 case 分支

```java
public void handleMessage(Message message) {
    switch (message.getAction()) {
        case LOGIN:
            if (loginController != null) {
                loginController.handleLoginResponse(message);
            }
            break;
        // 添加新功能时，在这里添加新的 case 分支
        // case REGISTER:
        //     if (registerController != null) {
        //         registerController.handleRegisterResponse(message);
        //     }
        //     break;
        default:
            System.out.println("未处理的消息类型: " + message.getAction());
            break;
    }
}
```

#### 1.4如果在服务端开发新的controller，记得用IClientController接口
```java
package com.vcampus.client.controller;

public class LoginController implements IClientController {
    
    
    @Override
    public void registerToMessageController() {
    }
    
}

```

### 2. 网络通信架构说明

#### 2.1 消息流转过程

1. **客户端发送**: 客户端通过 `SocketClient.sendMessage()` 发送消息
2. **服务端接收**: 服务端 `SocketServer` 接收消息并转发给 `MessageController`
3. **服务端处理**: `MessageController` 根据 `ActionType` 路由到具体控制器
4. **服务端响应**: 具体控制器处理业务逻辑并返回响应消息
5. **客户端接收**: 客户端 `SocketClient` 异步接收响应并转发给 `MessageController`
6. **客户端处理**: 客户端 `MessageController` 根据 `ActionType` 路由到具体控制器

#### 2.2 消息格式规范

```java
Message message = new Message();
message.setAction(ActionType.LOGIN);  // 必须设置动作类型
message.setData(userData);            // 业务数据
message.setStatus("SUCCESS");         // 状态信息
message.setMessage("登录成功");        // 消息描述
```
